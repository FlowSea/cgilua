<!$Id: templates.html,v 1.1 2003/09/28 23:38:45 tomas Exp $>
<head>
<title>CGILua 4.0: HTML Templates</title>
<style type="text/css">
ul { list-style-type: disc };
</style>
</head>

<body bgcolor="#FFFFFF">

<h2>HTML Templates</h2>

An HTML Template is an HTML file which will be processed by
CGILua before the HTTP server sends it to the client.
CGILua does not process HTML but it searches some special
marks that include Lua code into the file.
After all those marks are processed, the resulting file
is sent to the client.
<p>
There are four different marks:
<a href="#expression_fields">expression fields</a>,
<a href="#code_fields">code fields</a>,
<a href="#loop_directive">LOOP directive</a> and
<a href="#if_directive">IF directive</a>.
<p>
<a name="expression_fields"></a>
<h3>Expression fields</h3>

General form:
<table>
  <tr>
    <td bgcolor="#FFFFEE"><code> $| <i>Lua-expression</i> |$ </code></td>
  </tr>
</table>
<p>
These marks tell CGILua to execute the Lua expression and
substitute it in the file with the resulting value.
So, the expression must evaluate to a string or a number.
Also, <tt>nil</tt> expressions are treated as empty strings.
This is the right place for making output of HTML generated
dynamically.
<p>
A simple example like the one below will show the IP address
of the client machine:
<table>
  <tr>
    <td bgcolor="#FFFFEE"><pre>Dynamic page&lt;br&gt;
Your IP address is $| getenv("REMOTE_ADDR") |$</pre>
    </td>
  </tr>
</table>
<p>
<a name="code_fields"></a>
<h3>Code fields</h3>

General form:
<table>
  <tr>
    <td bgcolor="#FFFFEE">
      <code> &lt;!--$$ <i>Lua-code</i> $$--&gt; </code>
    </td>
  </tr>
</table>
<p>
These marks tell CGILua to execute the Lua code and delete the
code from the file.
This is not the proper place for output;
it should be used to define variables or functions and
to process some initialization, like loading libraries,
establishing connection with databases etc.
<p>
Each code inside a different code field will be executed in a
different Lua chunk so one must be careful about defining
local and global variables: the local ones won't be visible
at any other code field or expression field.
<p>
Below there is a simple example of its use:
<table>
  <tr>
    <td bgcolor="#FFFFEE"><pre>&lt;!--$$
-- Lua table definition
months = { "january", "february", "march", "april", "may", "june",
"july", "august", "september", "october", "november", "december", }
$$--&gt;

Now is the month of $|months[tonumber(date("%m"))]|$</pre>
    </td>
  </tr>
</table>
<p>
<a name="loop_directive"></a>
<h3>LOOP directive</h3>

General form:
<table>
  <tr>
    <td bgcolor="#FFFFEE">
      <pre>&lt;!--$$ LOOP start='<i>init</i>', test='<i>condition</i>', action='<i>cycle</i>' $$--&gt;
<i>HTML code</i>
&lt;!--$$ ENDLOOP $$--&gt; </pre>
    </td>
  </tr>
</table>
<p>
This directive tells CGILua to reproduce the HTML code between
<tt>LOOP</tt> and <tt>ENDLOOP</tt> while the test condition is
true.
This construction is very similar to a <tt>for</tt> construction
of C/C++: the <i>init</i> is executed just once, at the beginning;
the <i>test condition</i> is evaluated before each loop iteration
and it decides whether the loop must continue or stop; the <i>cycle</i>
is executed after all iterations.
<p>
The <i>init</i> and <i>cycle</i> values should be Lua statements;
so they can be nil, also.
The value of <i>test condition</i> will be used in a Lua
condition, so it must be a Lua expression.
The <i>HTML code</i> inside the loop can have any of the special marks.
<p>
The following example uses explression fields, code fields and
the LOOP directive.
When run, it will show the values of the environment variables listed:
<table>
  <tr>
    <td bgcolor="#FFFFEE"><pre>&lt;!--$$
env = {
  'GATEWAY_INTERFACE', 'SERVER_NAME',     'SERVER_SOFTWARE',
  'SERVER_PROTOCOL',   'SERVER_PORT',     'REQUEST_METHOD',
  'PATH_INFO',         'PATH_TRANSLATED', 'SCRIPT_NAME',
  'QUERY_STRING',      'REMOTE_HOST',     'REMOTE_ADDR',
  'AUTH_TYPE',         'REMOTE_USER',     'CONTENT_TYPE',
  'CONTENT_LENGTH',    'HTTP_ACCEPT',     'HTTP_USER_AGENT',
  'HTTP_REFERER',
}
$$--&gt;

&lt;table border&gt;
  &lt!--$$ LOOP start='i=1', test='env[i]', action='i=i+1' $$--&gt;
    &lt;tr&gt;
      &lt;td&gt;$|env[i]|$&lt;/td&gt;
      &lt;td&gt;$|getenv(env[i]) or '[not defined]'|$&lt;/td&gt;
    &lt;/tr&gt;
  &lt!--$$ ENDLOOP $$--&gt;
&lt;/table&gt;
</pre>
    </td>
  </tr>
</table>
<p>
<a name="if_directive"></a>
<h3>IF directive</h3>

General form:
<table>
  <tr>
    <td bgcolor="#FFFFEE">
      <pre>&lt;!--$$ IF test='<i>condition</i>' $$--&gt;
<i>HTML code (condition is true)</i>
&lt;!--$$ ELSE $$--&gt;
<i>HTML code (condition is false)</i>
&lt;!--$$ ENDLOOP $$--&gt; </pre>
    </td>
  </tr>
</table>
<p>
This directive is used to write optional HTML code or alternatives
depending on some conditions.
<p>
<table>
  <tr>
    <td bgcolor="#FFFFEE"><pre>
&lt;!--$$ IF test='cgi.login=="admin"' $$--&gt;
  &lt;table&gt;
    &lt;tr&gt;
      &lt;td&gt; Name: &lt;/td&gt;
      &lt;td&gt; &lt;input type="text" name="name" value="$|cgi.name|$"&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; Address: &lt;/td&gt;
      &lt;td&gt; &lt;input type="text" name="address" value="$|cgi.address|$"&gt; &lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; City: &lt;/td&gt;
      &lt;td&gt; &lt;input type="text" name="city" value="$|cgi.city|$"&gt; &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;!--$$ ELSE $$--&gt;
  $|cgi.name|$&lt;br&gt;
  $|cgi.address|$ - $|cgi.city|$
&lt;!--$$ ENDIF $$--&gt;
</pre>
    </td>
  </tr>
</table>

<hr>
<small>
Last update:
Wed Aug 28 09:57:25 EST 2002
</small>

</body>
</html>
