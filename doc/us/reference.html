<html>

<head>
<title>CGILua 5.0: Reference</title>
<style type="text/css">
ul { list-style-type: disc };
</style>
</head>

<body bgcolor="#FFFFFF">

<center>
<table border=0 cellspacing=2 cellpadding=2>
<tr><td align=center><a href="http://www.keplerproject.org">
<img border=0 alt="CGILua" src="cgi-128.gif"></a>
<tr><td align=center><big><b>CGILua 5.0</b></big>
<tr><td align=center valign=top>Reference guide
</table>
</center>
<p>

<center><small>
<a href="index.html">home</a> &middot;
<a href="#headers">headers</a> &middot;
<a href="#prep">pre-processing</a> &middot;
<a href="#contents">contents</a> &middot;
<a href="#variables">variables</a> &middot;
<a href="#error_treatment">error treatment</a> &middot;
<a href="#behavior">behavior</a> &middot;
<a href="#auxiliar">auxiliar</a> &middot;
<a href="#internals">internals</a>
</small></center>

<hr>
<a name="headers"</a>
<h2>Headers</h2>

<a name="contentheader"></a>
<h3><code>cgilua.contentheader (type, subtype)</code></h3>
Sends a <i>Content-type</i> header with the given values of type and sub-type.

<a name="htmlheader"></a>
<h3><code>cgilua.htmlheader ()</code></h3>
Sends the header of an HTML file.

<a name="locationheader"></a>
<h3><code>cgilua.locationheader (url)</code></h3>
Sends the header to force a redirection to the given URL.

<a name="redirect"></a>
<h3><code>cgilua.redirect (url, args)</code></h3>
Sends the header to force a redirection to the given URL adding the parameters
in table <tt>args</tt> to the new URL.

<a name="header"></a>
<h3><code>cgilua.header (header, value)</code></h3>
Sends a generic header.
This function should <em>not</em> be used to generate a
<em>Content-type</em> nor a <em>Location</em> header.


<hr>
<a name="contents"></a>
<h2>Content generation</h2>

<a name="mkabsoluteurl"></a>
<h3><code>cgilua.mkabsoluteurl (path)</code></h3>
Create an absolute URL containing the given URL path.

<a name="mkurlpath"></a>
<h3><code>cgilua.mkurlpath (script [, args])</code></h3>
Create an URL path to be used as a link to a CGILua script.

<a name="put"></a>
<h3><code>cgilua.put (string)</code></h3>
Sends the given string to the client.

<a name="error_log"></a>
<h3><code>cgilua.error_log (string)</code></h3>
Sends the given string to the error log file.


<hr>
<a name="prep"</a>
<h2>Pre-processing</h2>

<a name="includehtml"></a>
<h3><code>cgilua.includehtml (filename)</code></h3>
Pre-processes the given HTML file and sends the result to the client.

<a name="preprocess"></a>
<h3><code>cgilua.preprocess (filename)</code></h3>
Equivalent to <a href="includehtml"><code>includehtml</code></a> but
sends the HTML header before the pre-processed file.


<hr>
<a name="variables"></a>
<h2>CGILua's variables</h2>

<a name="script_path"></a>
<h3><code>cgilua.script_path ()</code></h3>
The complete path of the running script.
This variable is usually the same as the CGI environment variable
<code>PATH_TRANSLATED</code>.

<a name="script_pdir"></a>
<h3><code>cgilua.script_pdir ()</code></h3>
The directory of the running script.
Obtained from <a href="#script_path"><code>cgilua.script_path</code></a>.

<a name="script_file"></a>
<h3><code>cgilua.script_file ()</code></h3>
The file name of the running script.
Obtained from <a href="#script_path"><code>cgilua.script_path</code></a>.

<a name="script_vpath"></a>
<h3><code>cgilua.script_vpath ()</code></h3>
The complete virtual path of the running script.
Equivalent to CGI environment variable <code>PATH_INFO</code>.

<a name="script_vdir"></a>
<h3><code>cgilua.script_vdir ()</code></h3>
The virtual directory of the running script.
Obtained from <a href="#script_vpath"><code>cgilua.script_vpath</code></a>.

<a name="servervariable"></a>
<h3><code>cgilua.servervariable (varname)</code></h3>
Returns the value of a CGI environment variable.

<a name="urlpath"></a>
<h3><code>cgilua.urlpath ()</code></h3>
The name of the script.
Equivalent to CGI environment variable <code>SCRIPT_NAME</code>.


<hr>
<a name="error_treatment"></a>
<h2>Error treatment</h2>

<a name="seterrorhandler"></a>
<h3><code>cgilua.seterrorhandler (func)</code></h3>
Sets <i>errorhandler</i> function.
This function is called by Lua when an error occurs.
It receives the error message generated by Lua and it is resposible
for the final message which should be returned.

<a name="seterrorlog"></a>
<h3><code>cgilua.seterrorlog (func)</code></h3>
Sets the <i>errorlog</i> function.
This function is called to log the error message.

<a name="seterroroutput"></a>
<h3><code>cgilua.seterroroutput (func)</code></h3>
Sets the <i>erroroutput</i> function.
This function is called to generate the error output.


<hr>
<a name="behavior"></a>
<h2>CGILua's behavior</h2>

<a name="addscripthandler"></a>
<h3><code>cgilua.addscripthandler (ext, func)</code></h3>
Defines a function to pre-process a certain type of files.
The default configuration uses
<code>cgilua.doscript</code> to process Lua scripts (<tt>.lua</tt> files) and
<code>cgilua.preprocess</code> to process HTML templates (<tt>.lp</tt> files).

<a name="addclosefunction"></a>
<h3><code>cgilua.addclosefunction (func)</code></h3>
Defines a function to be executed after the script finishes.

<a name="setlibdir"></a>
<h3><code>cgilua.setlibdir (dir)</code></h3>
Sets CGILua's default libraries directory.
This value will be used to build the current <code>LUA_PATH</code>
used by the redefined <code>require</code> function.

<a name="setmaxfilesize"></a>
<h3><code>cgilua.setmaxfilesize (size)</code></h3>
Sets the maximum size for each "uploaded" file (in bytes).
This value is bounded by the maximum "total" input size (see
<a href="#setmaxinput">cgilua.setmaxinput</a>).

<a name="setmaxinput"></a>
<h3><code>cgilua.setmaxinput (size)</code></h3>
Sets the maximum "total" input size allowed (in bytes).


<hr>
<a name="auxiliar"></a>
<h2>Auxiliar functions</h2>

<a name="splitpath"></a>
<h3><code>cgilua.splitpath (path)</code></h3>
Extracts the "directory" and "file" parts of a given path.

<a name="encodetable"></a>
<h3><code>cgilua.encodetable (table)</code></h3>
URL-encode the elements of a table creating a string to be used in a
URL for passing data/parameters to another script.


<hr>
<a name="internals"></a>
<h2>Internal functions</h2>

<a name="close"></a>
<h3><code>cgilua.close ()</code></h3>
Executes the defined closing function, if it exists.

<a name="doif"></a>
<h3><code>cgilua.doif (path)</code></h3>
Execute the given file if there is no "file error".
If an error occurs, returns <code>nil</code> followed by an error message.

<a name="doscript"></a>
<h3><code>cgilua.doscript (path)</code></h3>
Execute the given file.
Raises an error if it occurs.

<a name="getparams"></a>
<h3><code>cgilua.getparams (args)</code></h3>
Defines CGILua's variables and assigns all parameters to the given table.

<a name="getscripthandler"></a>
<h3><code>cgilua.getscripthandler (path)</code></h3>
Gets the handler defined to process the given path.

<a name="handle"></a>
<h3><code>cgilua.handle (path)</code></h3>
Executes a script (given its full path) according to the defined handlers.

<a name="parsequery"></a>
<h3><code>cgilua.parsequery (query, args)</code></h3>
Parse URL-encoded request data.
This could be the query part of the script URL or URL-encoded post data.
Each decoded
<em>name = value</em>
pair is inserted into table
<code>args</code>.

<a name="pcall"></a>
<h3><code>cgilua.pcall (func, ...)</code></h3>
Executes a function using the CGILua's error functions.

<a name="removeglobals"></a>
<h3><code>cgilua.removeglobals (notallowed)</code></h3>
Removes the variables listed in table <code>notallowed</code>.

<a name="reset"></a>
<h3><code>cgilua.reset ()</code></h3>
Resets CGILua's internal state.


<hr>
<small>
$Id: reference.html,v 1.7 2004/06/08 16:36:20 tomas Exp $
</small>

</body>
</html>

