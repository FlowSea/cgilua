<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>CGILua - Building web scripts with Lua</title>
    <link rel="stylesheet" href="http://www.keplerproject.org/doc.css" type="text/css"/>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>

<div id="container">
	
<div id="product">
	<div id="product_logo"><a href="http://www.keplerproject.org">
		<img alt="CGILua logo" src="cgi-128.gif"/>
	</a></div>
	<div id="product_name"><big><b>CGILua</b></big></div>
	<div id="product_description">Building web scripts with Lua</div>
</div> <!-- id="product" -->

<div id="main">
	
<div id="navigation">
<h1>CGILua</h1>
	<ul>
		<li><a href="index.html">Home</a>
			<ul>
				<li><a href="index.html#overview">Overview</a></li>
				<li><a href="index.html#status">Status</a></li>
				<li><a href="index.html#download">Download</a></li>
				<li><a href="index.html#history">History</a></li>
				<li><a href="index.html#incompatibility">Incompatibilities</a></li>
				<li><a href="index.html#credits">Credits</a></li>
				<li><a href="index.html#contact">Contact us</a></li>
			</ul>
		</li>
		<li><a href="manual.html">Manual</a>
			<ul>
				<li><a href="manual.html#intro">Introduction</a></li>
				<li><a href="manual.html#installation">Installation</a></li>
				<li><a href="manual.html#config">Configuration</a></li>
				<li><a href="manual.html#scripts">Lua Scripts</a></li>
				<li><a href="manual.html#templates">Lua Pages</a></li>
				<li><a href="manual.html#parameters">Parameters</a></li>
			</ul>
		</li>
		<li><strong>CGILua reference</strong>
			<ul>
				<li><a href="reference.html#headers">Headers</a></li>
				<li><a href="reference.html#contents">Content generation</a></li>
				<li><a href="reference.html#prep">Pre-processing templates</a></li>
				<li><a href="reference.html#variables">CGILua's variables</a></li>
				<li><a href="reference.html#error_handling">Error Handling</a></li>
				<li><a href="reference.html#behavior">CGILua behavior</a></li>
				<li><a href="reference.html#auxiliar">Auxiliary functions</a></li>
				<li><a href="reference.html#urlcode">URL encoding functions</a></li>
				<li><a href="reference.html#index">Alphabetic index</a></li>
			</ul>
		</li>
		<li><a href="libraries.html">Distributed libraries</a>
			<ul>
				<li><a href="libraries.html#cookies">Cookies</a></li>
				<li><a href="libraries.html#serialize">Serialize</a></li>
				<li><a href="libraries.html#session">Session</a></li>
				<li><a href="libraries.html#stable">Stable</a></li>
			</ul>
		</li>
		<li><a href="sapi.html">Server API</a></li>
		<li><a href="examples.html">Examples</a></li>
		<li><a href="license.html">License</a></li>
	</ul>
</div> <!-- id="navigation" -->

<div id="content">


<h2><a name="headers"></a>Headers</h2>


<h3><a name="contentheader"></a><code>cgilua.contentheader (type, subtype)</code></h3>
Sends a <i>Content-type</i> header with the given values of type and
sub-type.<br>
Both arguments are strings: <tt>type</tt> is the header type;
<tt>subtype</tt> is the header sub-type.<br>
Returns nothing.


<h3><a name="htmlheader"></a><code>cgilua.htmlheader ()</code></h3>
Sends the header of a HTML file (<i>Content-type: text/html</i> followed
by two <i>line-feeds</i>).<br>
Returns nothing.


<h3><a name="locationheader"></a><code>cgilua.locationheader (url)</code></h3>
Sends the header to force a redirection to the given URL.<br>
The argument must be a string.<br>
Returns nothing.


<h3><a name="redirect"></a><code>cgilua.redirect (url, args)</code></h3>
Sends the header to force a redirection to the given URL adding the parameters
in table <tt>args</tt> to the new URL.<br>
The first argument (<tt>url</tt>) is the URL the browser should be
redirected to;
the second one (<tt>args</tt>) is an optional table which could have pairs
<i>name = value</i> that will be encoded to form a valid URL
(see function <a href="#encodetable">cgilua.urlcode.encodetable</a>).<br>
Returns nothing.


<h3><a name="header"></a><code>cgilua.header (header, value)</code></h3>
Sends a generic header.
This function should <em>not</em> be used to generate a
<em>Content-type</em> nor a <em>Location</em> header.<br>
Both arguments are strings: <tt>header</tt> is the name of the header;
<tt>value</tt> is its value.<br>
Returns nothing.


<h2><a name="contents"></a>Content generation</h2>


<h3><a name="mkabsoluteurl"></a><code>cgilua.mkabsoluteurl (path)</code></h3>
Creates an absolute URL containing the given URL path.<br>
Returns nothing.


<h3><a name="mkurlpath"></a><code>cgilua.mkurlpath (script [, args])</code></h3>
Creates an URL path to be used as a link to a CGILua script.<br>
Returns nothing.


<h3><a name="put"></a><code>cgilua.put (string)</code></h3>
Sends the given string to the client.<br>
Returns nothing.


<h2><a name="lp"</a>Lua Pages</h2>


<h3><a name="include"></a><code>cgilua.lp.include (filename)</code></h3>
Pre-processes the given HTML file and sends the result to the client.<br>
Returns nothing.


<h3><a name="handlelp"></a><code>cgilua.handlelp (filename)</code></h3>
Equivalent to <a href="include"><code>lp.include</code></a> but
sends the HTML header before the pre-processed file.<br>
Returns nothing.


<h3><a name="setcompatmode"></a><code>cgilua.lp.setcompatmode (boolean)</code></h3>
Turns on or off the compatibility mode.
Turning it on will make the translator understands the old
<i>expression fields</i> and <i>code fields</i>
structures, now obsolete.<br>
Returns nothing.


<h3><a name="setoutfunc"></a><code>cgilua.lp.setoutfunc (outfuncname)</code></h3>
Defines the output function.
The translator will write calls to the function with the given name.<br>
Returns nothing.


<h3><a name="translate"></a><code>cgilua.lp.translate (string)</code></h3>
Creates a string with Lua code that reproduces the given string executing
the Lua chunks or expressions inside it.<br>
Returns a string with the resulting code.



<h2><a name="variables"></a>CGILua's variables</h2>


<h3><a name="script_file"></a><code>cgilua.script_file</code></h3>
The file name of the running script.
Obtained from <a href="#script_path"><code>cgilua.script_path</code></a>.


<h3><a name="script_path"></a><code>cgilua.script_path</code></h3>
The complete path of the running script.
This variable is usually the same as the CGI environment variable
<code>PATH_TRANSLATED</code>.


<h3><a name="script_pdir"></a><code>cgilua.script_pdir</code></h3>
The directory of the running script.
Obtained from <a href="#script_path"><code>cgilua.script_path</code></a>.


<h3><a name="script_vdir"></a><code>cgilua.script_vdir</code></h3>
The virtual directory of the running script.
Obtained from <a href="#script_vpath"><code>cgilua.script_vpath</code></a>.


<h3><a name="script_vpath"></a><code>cgilua.script_vpath</code></h3>
The complete virtual path of the running script.
Equivalent to CGI environment variable <code>PATH_INFO</code>.


<h3><a name="servervariable"></a><code>cgilua.servervariable (varname)</code></h3>
Returns a string with the value of a CGI environment variable whose name
is indicated by the argument (<tt>varname</tt>).


<h3><a name="urlpath"></a><code>cgilua.urlpath</code></h3>
The name of the script.
Equivalent to CGI environment variable <code>SCRIPT_NAME</code>.



<h2><a name="error_handling"></a>Error Handling</h2>


<h3><a name="errorlog"></a><code>cgilua.errorlog (string)</code></h3>
Sends the given string to the error log file.<br>
Returns nothing.


<h3><a name="seterrorhandler"></a><code>cgilua.seterrorhandler (func)</code></h3>
Sets <i>errorhandler</i> function.
This function is called by Lua when an error occurs.
It receives the error message generated by Lua and it is resposible
for the final message which should be returned.<br>
Returns nothing.


<h3><a name="seterroroutput"></a><code>cgilua.seterroroutput (func)</code></h3>
Sets the <i>erroroutput</i> function.
This function is called to generate the error output.<br>
Returns nothing.



<h2><a name="behavior"></a>CGILua's behavior</h2>


<h3><a name="addscripthandler"></a><code>cgilua.addscripthandler (ext, func)</code></h3>
Defines a function to pre-process a certain type of files.
The default configuration uses
<code>cgilua.doscript</code> to process Lua scripts (<tt>.lua</tt> files) and
<code>cgilua.handlelp</code> to process Lua pages (<tt>.lp</tt> files).<br>
Returns nothing.


<h3><a name="addclosefunction"></a><code>cgilua.addclosefunction (func)</code></h3>
Defines a function to be called after the script execution.<br>
Returns nothing.


<h3><a name="addopenfunction"></a><code>cgilua.addopenfunction (func)</code></h3>
Defines a function to be called before the script execution.<br>
Returns nothing.


<h3><a name="buildplainhandler"></a><code>cgilua.buildplainhandler (type, subtype)</code></h3>
Creates a <i>script handler</i> that sends the given header and the plain
file requested.
The <i>Content-type</i> header is formed by the two arguments;
the created function will receive a <i>filename</i> as its only argument
and will return the given filename untouched.<br>
Returns a function.


<h3><a name="buildprocesshandler"></a><code>cgilua.buildprocesshandler (type, subtype)</code></h3>
Creates a <i>script handler</i> that sends the given header and the processed
file requested.
The <i>Content-type</i> header is formed by the two arguments;
the created function will receive a <i>filename</i> as its only argument
and will return the given filename pre-processed by the function
<a href="#include">cgilua.lp.include</a>.<br>
Returns a function.


<h3><a name="setlibdir"></a><code>cgilua.setlibdir (dir)</code></h3>
Sets CGILua's default libraries directory.
This value will be used to build the current <code>LUA_PATH</code>
used by the redefined <code>require</code> function.<br>
Returns nothing.


<h3><a name="setmaxfilesize"></a><code>cgilua.setmaxfilesize (size)</code></h3>
Sets the maximum size for each "uploaded" file (in bytes).
This value is bounded by the maximum "total" input size (see
<a href="#setmaxinput">cgilua.setmaxinput</a>).
This function only takes efect if used before POST data is processed,
therefore its use in scripts are useless.<br>
Returns nothing.


<h3><a name="setmaxinput"></a><code>cgilua.setmaxinput (size)</code></h3>
Sets the maximum "total" input size allowed (in bytes).
This function only takes efect if used before POST data is processed,
therefore its use in scripts are useless.<br>
Returns nothing.



<h2><a name="auxiliar"></a>Auxiliar functions</h2>


<h3><a name="doscript"></a><code>cgilua.doscript (path)</code></h3>
Executes the given file.
Raises an error if it occurs.
In case of success, returns the values returned by the execution.


<h3><a name="pack"></a><code>cgilua.pack (...)</code></h3>
Returns a new table with all its arguments stored in it.


<h3><a name="splitpath"></a><code>cgilua.splitpath (path)</code></h3>
Returns two strings with the "directory" and "file" parts of the given
<code>path</code>.



<h2><a name="urlcode"></a>URL encoding functions</h2>


<h3><a name="encodetable"></a><code>cgilua.urlcode.encodetable (table)</code></h3>
<i>URL-encode</i> the elements of a table creating a string to be used in a
URL for passing data/parameters to another script.<br>
Returns a string representing the argument <code>table</code>.


<h3><a name="escape"></a><code>cgilua.urlcode.escape (string)</code></h3>
<i>URL-encode</i> a string.<br>
Returns the encoded string.


<h3><a name="insertfield"></a><code>cgilua.urlcode.insertfield (args, name, value)</code></h3>
Adds the given <tt>value</tt> to the field <tt>name</tt> in table <tt>args</tt>.
If the field already has a value,
it is transformed into a table with the previous (at index <tt>1</tt>) and
the new value (at index <tt>2</tt>).
Other values will be added at the end of the <i>array-part</i> of the table.<br>
Returns nothing.


<h3><a name="parsequery"></a><code>cgilua.urlcode.parsequery (query, args)</code></h3>
Parse URL-encoded request data.
This could be the query part of the script URL or URL-encoded post data.
Each decoded
<em>name = value</em>
pair is inserted into table
<code>args</code>.<br>
Returns nothing.


<h3><a name="unescape"></a><code>cgilua.urlcode.unescape (string)</code></h3>
<i>URL-decode</i>s a string.<br>
Returns the decoded string.



<h2><a name="index"></a>Alphabetic Index</h2>
<a href="#addclosefunction">addclosefunction</a><br>
<a href="#addopenfunction">addopenfunction</a><br>
<a href="#addscripthandler">addscripthandler</a><br>
<a href="#buildplainhandler">buildplainhandler</a><br>
<a href="#buildprocesshandler">buildprocesshandler</a><br>
<a href="#contentheader">contentheader</a><br>
<a href="#doscript">doscript</a><br>
<a href="#encodetable">encodetable (urlcode)</a><br>
<a href="#errorlog">errorlog</a><br>
<a href="#escape">escape (urlcode)</a><br>
<a href="#header">header</a><br>
<a href="#htmlheader">htmlheader</a><br>
<a href="#include">include (lp)</a><br>
<a href="#insertfield">insertfield (urlcode)</a><br>
<a href="#locationheader">locationheader</a><br>
<a href="#mkabsoluteurl">mkabsoluteurl</a><br>
<a href="#mkurlpath">mkurlpath</a><br>
<a href="#pack">pack</a><br>
<a href="#parsequery">parsequery (urlcode)</a><br>
<a href="#handlelp">handlelp</a><br>
<a href="#lp">lp</a><br>
<a href="#put">put</a><br>
<a href="#redirect">redirect</a><br>
<a href="#script_file">script_file</a><br>
<a href="#script_path">script_path</a><br>
<a href="#script_pdir">script_pdir</a><br>
<a href="#script_vdir">script_vdir</a><br>
<a href="#script_vpath">script_vpath</a><br>
<a href="#servervariable">servervariable</a><br>
<a href="#setcompatmode">setcompatmode (lp)</a><br>
<a href="#seterrorhandler">seterrorhandler</a><br>
<a href="#seterroroutput">seterroroutput</a><br>
<a href="#setlibdir">setlibdir</a><br>
<a href="#setmaxfilesize">setmaxfilesize</a><br>
<a href="#setmaxinput">setmaxinput</a><br>
<a href="#setoutfunc">setoutfunc (lp)</a><br>
<a href="#splitpath">splitpath</a><br>
<a href="#urlcode">urlcode</a><br>
<a href="#unescape">unescape (urlcode)</a><br>
<a href="#urlpath">urlpath</a><br>

</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
	<p><small>
	$Id: reference.html,v 1.22 2005/07/14 15:50:37 carregal Exp $
	</small></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->

</body>
</html> 
