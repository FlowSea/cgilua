
<h2>Compilation</h2>

<p>Requirements:
<ul>
<li><a href="http://www.keplerproject.org/luajava">LuaJava 1.0 Beta 4</a></li>
<li><a href="http://logging.apache.org/log4j/docs/">Log4J</a></li>
<li>Any servlet container. <a href="http://jakarta.apache.org/tomcat">Tomcat</a> 
will be used in the guide.</li>
</ul>
</p>

<p>
You have two options to compile cgilua servlet launcher, use the provided 
<a href="http://ant.apache.org/">Ant</a> build file or use the provided Makefile.
</p>

<h3>Ant</h3>

<p>
If you don't know how to use Ant you should read the manual at 
<a href="http://ant.apache.org/manual/index.html">http://ant.apache.org/manual/index.html</a>.<br>

Edit the <code>build.xml</code> to modify the properties <code>cgilua.dir</code> and <code>libext</code>.<br>
</p>

<p>
The <code>cgilua.dir</code> property defines the installation directory for cgilua.
This directory is used as the base for lua modules loading.
</p>

<p>
The <code>libext</code> property must contain the shared library extension 
used by your OS. Example:
<ul>
<li>Windows: ".dll"</li>
<li>MacOS: ".dylib"</li>
<li>Unix: ".so"</li>
</ul>
</p>

<p>
After editing the <code>build.xml</code> file, run the default target.
</p>

<h3>Makefile</h3>

Edit cgilua <code>config</code> file, and <code>make</code>.

<h2>Installation and Configuration</h2>

<p>
Whichever compilation method you choose, Ant or Makefile, three files are generated:
<ul>
<li><code>cgilua-5.0b.jar</code>: CGILua servlet implementation</li>
<li><code>WEB-INF/web.xml</code>: sample application descriptor</li>
<li><code>servlet.lua</code>: CGILua sapi implementation</li>
</ul>
</p>

<p>
Any servlet container can be used to run cgilua applications through the
servlet launcher. Tomcat will be used as an example.
</p>

<p>
The application descriptor, <code>WEB-INF/web.xml</code>, defines a servlet called <code>CGILuaLauncherServlet</code>.
This configuration is listed below.<br>

<pre>
<xmp>
  <servlet>
    <servlet-name>cgilua</servlet-name>
    <servlet-class>org.keplerproject.cgilua.servlet.CGILuaServlet</servlet-class>
    
    <!-- Full path of CGILua servlet lua launcher -->
    <init-param>
      <param-name>cgilua.launcherpath</param-name>
      <param-value>C:/Program Files/CGILua/servlet.lua</param-value>
    </init-param>
    
    <!-- CGILua installation dir -->
    <init-param>
      <param-name>cgilua.basedir</param-name>
      <param-value>C:/Program Files/CGILua</param-value>
    </init-param>

    <!-- Number of LuaState's created for the pool to handle requests. -->
    <init-param>
      <param-name>cgilua.poolsize</param-name>
      <param-value>30</param-value>
    </init-param>
  </servlet>

  <!-- CGILua files extension mappings -->
  <servlet-mapping>
    <servlet-name>cgilua</servlet-name>
    <url-pattern>*.lua</url-pattern>
  </servlet-mapping>

  <servlet-mapping>
    <servlet-name>cgilua</servlet-name>
    <url-pattern>*.lp</url-pattern>
  </servlet-mapping>
</xmp>
</pre>
</p>

<p>
In order to configure CGILua to run on every Tomcat application insert the above
configuration to <code>"$(CATALINA_HOME)/conf/web.xml"</code>.<br>

Install LuaJava JNI library in a path included by the java system variable 
<code>"java.library.path"</code>.<br>
Usually the most suitable paths are <code>"$(JAVA_HOME)/jre/bin"</code> and <code>"$(CATALINA_HOME)/bin"</code>.<br>
Make sure Tomcat if configured to use the specified JRE.<br>

Install LuaJava, Log4J and cgilua jar files in <code>"$(CATALINA_HOME)/common/lib"</code><br>

Create a simple Tomcat application with a ".lua" file and "run" it.<br>
</p>
